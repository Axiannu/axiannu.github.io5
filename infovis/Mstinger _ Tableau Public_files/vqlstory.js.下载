/*! BEGIN StoryModule */
(function(){'dont use strict';var a={};global.tab=global.tab||{};ss.initAssembly(a,'vqlstory');var b=function(){};b.__typeName='tab.FlipboardNavigatorExtensions';b.getViewModelFromStoryId=function(y,z){return _.find(y,function(A){return A.get_storyPointId()===z;});};global.tab.FlipboardNavigatorExtensions=b;var c=function(){this.points=null;spiff.Template.call(this,$("<span class='tabFlipboardNavPoints'/>"));this.points=this.domRoot;};c.__typeName='tab.FlipboardNavigatorPointsTemplate';global.tab.FlipboardNavigatorPointsTemplate=c;var d=function(){this.previous=null;this.scroller=null;this.next=null;this.previousArrow=null;this.nextArrow=null;spiff.Template.call(this,$("<div class='tabFlipboardNav'><span class='tabFlipboardNavPrevious'><div class='tabStoryLeftArrow'/></span><span class='tabFlipboardNavScroller'/><span class='tabFlipboardNavNext'><div class='tabStoryRightArrow'/></span></div>"));this.previous=this.getElementBySelector('.tabFlipboardNavPrevious');this.scroller=this.getElementBySelector('.tabFlipboardNavScroller');this.next=this.getElementBySelector('.tabFlipboardNavNext');this.previousArrow=this.getElementBySelector('.tabStoryLeftArrow');this.nextArrow=this.getElementBySelector('.tabStoryRightArrow');};d.__typeName='tab.FlipboardNavigatorTemplate';global.tab.FlipboardNavigatorTemplate=d;var e=function(y){this.$l=null;this.$n=null;this.$m=null;ss.makeGenericType(spiff.BaseView$1,[f]).call(this,y,new d());this.$k();this.$f();this.get_flipboardNavViewModel().add_resizeZone(ss.mkdel(this,this.handleResize));this.get_flipboardNavViewModel().add_resizeZone(ss.mkdel(this,this.$a));this.get_flipboardNavViewModel().add_updateActivePoint(ss.mkdel(this,this.handleUpdateActivePoint));this.get_flipboardNavViewModel().add_remoteUpdateComplete(ss.mkdel(this,this.$c));this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.get_flipboardNavViewModel().remove_resizeZone(ss.mkdel(this,this.handleResize));this.get_flipboardNavViewModel().remove_resizeZone(ss.mkdel(this,this.$a));this.get_flipboardNavViewModel().remove_updateActivePoint(ss.mkdel(this,this.handleUpdateActivePoint));this.get_flipboardNavViewModel().remove_remoteUpdateComplete(ss.mkdel(this,this.$c));tab.StyleUtil.clearStyleSheet('appendedStoryStyle');})));this.$b();};e.__typeName='tab.FlipboardNavigatorView';global.tab.FlipboardNavigatorView=e;var f=function(y){this.$d=null;this.$a=[];this.$c=false;this.$b=null;this.$e=null;this.$2$1=null;this.$2$2=null;this.$2$3=null;spiff.BaseViewModel.call(this);this.$d=y;this.$d.add_newFlipboardNav(ss.mkdel(this,this.handleNewFlipboardNav));this.$d.get_zone().get_zoneCommonModel().add_resizeZone(ss.mkdel(this,this.$4));this.$d.add_pointWasCaptured(ss.mkdel(this,this.handlePointWasCaptured));this.$d.add_navArrowVisibilityChanged(ss.mkdel(this,this.handleNavArrowVisibilityChanged));spiff.GlobalUIEvents.add_dismissTemporaryElements(ss.mkdel(this,this.hideUberMenuImmediately));w.$2(ss.mkdel(this,this.closeUberMenu));w.$4(ss.mkdel(this,this.handlePointWasCaptured));this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.$d.remove_newFlipboardNav(ss.mkdel(this,this.handleNewFlipboardNav));this.$d.get_zone().get_zoneCommonModel().remove_resizeZone(ss.mkdel(this,this.$4));this.$d.remove_pointWasCaptured(ss.mkdel(this,this.handlePointWasCaptured));this.$d.remove_navArrowVisibilityChanged(ss.mkdel(this,this.handleNavArrowVisibilityChanged));spiff.GlobalUIEvents.remove_dismissTemporaryElements(ss.mkdel(this,this.hideUberMenuImmediately));w.$3(ss.mkdel(this,this.closeUberMenu));w.$5(ss.mkdel(this,this.handlePointWasCaptured));this.$e.dispose();})));this.$e=tab.ObjectRegistry.resolve(m).call(null,[]);this.$b=[];this.$2();var z=null;z=ss.mkdel(this,function(){this.$9();tab.CommandController.get().remove_commandQueueComplete(z);});tab.CommandController.get().add_commandQueueComplete(z);tab.StartupUtils.callAfterBootstrap(ss.mkdel(this,function(){this.$9();}));};f.__typeName='tab.FlipboardNavigatorViewModel';global.tab.FlipboardNavigatorViewModel=f;var g=function(){spiff.Template.call(this,$("<div class='tabFlipboard'></div>"));};g.__typeName='tab.FlipboardTemplate';global.tab.FlipboardTemplate=g;var h=function(y){this.$a=null;ss.makeGenericType(spiff.BaseView$1,[i]).call(this,y,new g());this.$a=y;this.$a.add_newStoryPoint(ss.mkdel(this,this.handleNewStoryPoint));this.$a.get_parentZone().add_resizeZone(ss.mkdel(this,this.handleResizeZone));this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.$a.remove_newStoryPoint(ss.mkdel(this,this.handleNewStoryPoint));this.$a.get_parentZone().remove_resizeZone(ss.mkdel(this,this.handleResizeZone));})));};h.__typeName='tab.FlipboardView';h.findFlipboard=function(){return $('.tabFlipboard');};h.$0=function(y,z){var A=tab.SizeUtil.unionPresModels(y,z);if(z.h>=y.h+3&&y.w-z.w>24){A.w-=24;}if(z.w>=y.w&&y.h+3-z.h>24){A.h-=24;}return A;};global.tab.FlipboardView=h;var i=function(y,z){this.$7=null;this.$8=null;this.$6=null;this.$2$1=null;spiff.BaseViewModel.call(this);this.$7=y;this.$8=z;this.$7.add_invalidateZone(ss.mkdel(this,this.$4));this.$7.get_storyPointModel().add_newStoryPoint(ss.mkdel(this,this.$3));this.$7.get_storyPointModel().add_dashboardDisposal(ss.mkdel(this,this.$2));this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.$7.remove_invalidateZone(ss.mkdel(this,this.$4));this.$7.get_storyPointModel().remove_newStoryPoint(ss.mkdel(this,this.$3));this.$7.get_storyPointModel().remove_dashboardDisposal(ss.mkdel(this,this.$2));})));if(ss.isValue(this.get_flipboardModel().get_dashboardModel())){this.$3();}};i.__typeName='tab.FlipboardViewModel';global.tab.FlipboardViewModel=i;var j=function(){};j.__typeName='tab.IFlipboardNavigatorView';global.tab.IFlipboardNavigatorView=j;var k=function(){};k.__typeName='tab.IStoryNavigatorContentView';global.tab.IStoryNavigatorContentView=k;var l=function(){};l.__typeName='tab.IStoryNavigatorPointView';global.tab.IStoryNavigatorPointView=l;var m=function(){};m.__typeName='tab.IStoryUberPopupContainer';global.tab.IStoryUberPopupContainer=m;var n=function(){};n.__typeName='tab.StoryClientCommands';n.setActiveStoryPoint=function(y,z){var A=$.Deferred();if(!tab.ApplicationModel.get_instance().get_workbook().get_isCurrentSheetStoryboard()||z.get_currentPointIndex()===y){A.resolve();return A.promise();}var B=tab.ApplicationModel.get_instance().get_workbook().get_storyboard().get_flipboard();var C=z.get_storyPoints()[y].storyPointId;var D=new tab.ClientCommand('none',function(E){n.$m(C,z,E,B);},n.$0(z.get_storyPoints()[y].storyPointId,tsConfig.is_authoring),tab.CommandController.DeferredSuccessHandler(A),tab.CommandController.deferredFailureHandler(A));tab.CommandController.SendCommand(D);return A.promise();};n.nextStoryPoint=function(y){var z=$.Deferred();if(!tab.ApplicationModel.get_instance().get_workbook().get_isCurrentSheetStoryboard()){z.reject("The workbook's current sheet is not a story");return z.promise();}var A=y.get_currentPointIndex()+1;var B=tab.ApplicationModel.get_instance().get_workbook().get_storyboard().get_flipboard();var C=n.$f(y,z,B,A);var D=y.get_storyPoints()[A].storyPointId;var E=new tab.ClientCommand('none',function(F){n.$m(D,y,F,B);},n.$7(tsConfig.is_authoring),tab.CommandController.DeferredSuccessHandler(z),tab.CommandController.deferredFailureHandler(z));tab.CommandController.SendCommand(E);return C;};n.previousStoryPoint=function(y){var z=$.Deferred();if(ss.isNullOrUndefined(tab.ApplicationModel.get_instance().get_workbook().get_storyboard())){z.reject("The workbook's current sheet is not a story");return z.promise();}var A=y.get_currentPointIndex()-1;var B=tab.ApplicationModel.get_instance().get_workbook().get_storyboard().get_flipboard();var C=n.$f(y,z,B,A);var D=y.get_storyPoints()[A].storyPointId;var E=new tab.ClientCommand('none',function(F){n.$m(D,y,F,B);},n.$8(tsConfig.is_authoring),tab.CommandController.DeferredSuccessHandler(z),tab.CommandController.deferredFailureHandler(z));tab.CommandController.SendCommand(E);return C;};n.revertStoryPoint=function(y,z){return n.$l(n.$k,n.$b(y,z),null);};n.setFlipboardNavType=function(y){return n.$l(function(z){},n.$d(y),null);};n.captureStoryPoint=function(y){return n.$l(function(z){},n.$1(y),null);};n.newBlankStoryPoint=function(){return n.$l(function(y){},n.$6(),null);};n.duplicateActiveStoryPoint=function(){return n.$l(function(y){},n.$3(),null);};n.saveActiveStoryPointAsNew=function(){return n.$l(function(y){},n.$c(),'immediatelySubtle');};n.toggleArrows=function(){return n.$l(function(y){},n.$e(),null);};n.insertStoryPoint=function(y,z){return n.$l(function(A){},n.$5(y,z),null);};n.replaceStoryPoint=function(y,z){return n.$l(function(A){},n.$a(y,z),null);};n.reorderStoryPoint=function(y,z){return n.$l(function(A){},n.$9(y,z),null);};n.deleteStoryPoint=function(y){return n.$l(function(z){},n.$2(y),null);};n.editStoryPointCaption=function(y,z,A){return n.$l(function(B){n.$h(y,A,B);},n.$4(y,z),null);};n.$f=function(y,z,A,B){var C=z.promise();if(tab.FeatureFlags.isEnabled('StoryPointPrefetch')&&(!tsConfig.is_authoring||tab.FeatureFlags.isEnabled('StoryPointCache'))){var D=B+(B-y.get_currentPointIndex());if(D>=0&&D<y.get_flipboardNavPresModel().storypointNavItems.length){var E=y.get_flipboardNavPresModel().storypointNavItems[D].storyPointId;C=C.then(function(){_.defer(function(){n.$j(A,E);});},null);}}return C;};n.$j=function(y,z){if(tab.FlipboardModel.presModelCache.hasStoryPoint(z)){return;}var A=tab.CommandUtils.newCommand$1('get-storypoint',null);var B={};B['storyboard']=tsConfig.current_sheet_name;B['flipboardZoneId']=y.get_zoneId();B['storyPointId']=z;A.commandParams=B;var C=function(E){var F=E;if(ss.isValue(F)&&ss.isValue(F.dashboardPresModel)){tab.FlipboardModel.presModelCache.addStoryPoint(z,F);}};var D=new tab.RemoteClientCommand(A,'none',C,null);tab.CommandController.SendCommand(D);};n.$k=function(y){n.$i(y);};n.$b=function(y,z){var A=tab.CommandUtils.newCommand('revert-story-point',null);A.commandParams={};tab.CommandUtils.addStoryPointToCommand(A.commandParams,y);A.commandParams['storyPointId']=z.toString();return A;};n.$1=function(y){var z=n.$g('capture-story-point',true);z.commandParams['storyPointId']=y.toString();return z;};n.$h=function(y,z,A){if(ss.isValue(z)){var B=z.get_storyPoints()[z.get_currentPointIndex()];var C=A.makeMutablePresModel(z,false);B=C.storypointNavItems[z.get_currentPointIndex()];B.storyPointCaption=y;}};n.$m=function(y,z,A,B){if(ss.isValue(z)){var C=z.get_flipboardNavPresModel();var D=0;var E=false;var F=C.storypointNavItems;for(var G=0,H=F.length;G<H;G++){if(F[G].storyPointId===y){D=G;E=true;break;}}if(E){C=A.makeMutablePresModel(z,false);C.currentStorypointIndex=D;}}if(ss.isValue(B)&&(!tsConfig.is_authoring||tab.FeatureFlags.isEnabled('StoryPointCache'))&&ss.isValue(tab.FlipboardModel.presModelCache)&&tab.FlipboardModel.presModelCache.hasStoryPoint(y)){var I=tab.FlipboardModel.presModelCache.getStoryPoint(y);if(tab.ApplicationModel.get_instance().get_renderMode()!=='render-mode-client'){var J=A.makeMutablePresModel(tab.ApplicationModel.get_instance(),false);J.renderMode='render-mode-client';}var K=A.makeMutablePresModel(B,true);K.activeStoryPointId=y;K.storyPoints[y.toString()]=I;var L=A.makeMutablePresModel(tab.ApplicationModel.get_instance().get_dataDictionary(),false);L.dataSegments={};if(tab.FeatureParamsLookup.getBool(43)){tab.MetricsLogger.get_instance().logEvent(new tabBootstrap.MetricsEvent('gen',8,ss.mkdict(['Story','CacheHit'])));}}else{n.$i(A);}};n.$0=function(y,z){var A=n.$g('set-active-story-point',false);A.commandParams['storyPointId']=y.toString();A.commandParams['shouldAutoCapture']=(z?'true':'false');A.commandParams['shouldAutoRevert']=(z?'false':'true');return A;};n.$7=function(y){var z=n.$g('next-story-point',false);z.commandParams['shouldAutoCapture']=(y?'true':'false');z.commandParams['shouldAutoRevert']=(y?'false':'true');return z;};n.$8=function(y){var z=n.$g('previous-story-point',false);z.commandParams['shouldAutoCapture']=(y?'true':'false');z.commandParams['shouldAutoRevert']=(y?'false':'true');return z;};n.$d=function(y){var z=n.$g('set-flipboard-nav-type',false);z.commandParams['flipboardNavType']=y;return z;};n.$5=function(y,z){var A=n.$g('insert-story-point',false);A.commandParams['currentStorypointIndex']=z;A.commandParams['storyPointBase']=y;return A;};n.$a=function(y,z){var A=n.$g('replace-story-point',false);A.commandParams['storyPointId']=z;A.commandParams['storyPointBase']=y;return A;};n.$9=function(y,z){var A=n.$g('reorder-story-points',false);A.commandParams['storyPointId']=y;A.commandParams['currentStorypointIndex']=z;return A;};n.$2=function(y){var z=n.$g('delete-story-point',true);z.commandParams['storyPointId']=y;return z;};n.$6=function(){return n.$g('new-blank-story-point',false);};n.$3=function(){return n.$g('duplicate-active-story-point',false);};n.$c=function(){return n.$g('save-active-story-point-as-new',false);};n.$e=function(){return n.$g('toggle-storypoints-nav-arrows',true);};n.$4=function(y,z){var A=n.$g('edit-story-point-caption',true);A.commandParams['storyPointCaption']=y;A.commandParams['storyPointId']=z.toString();return A;};n.$g=function(y,z){var A=tab.CommandUtils.newCommand(y,null);var B=tab.ApplicationModel.get_instance().get_workbook().get_storyboard().get_flipboard();var C={};C['storyboard']=tsConfig.current_sheet_name;if(z){C['flipboardZoneId']=B.get_zoneId();}A.commandParams=C;return A;};n.$i=function(y){var z=tab.ApplicationModel.get_instance().get_workbook().get_storyboard().get_flipboard();if(ss.isValue(z)){z.invalidated(y.modelUpdateContext);}};n.$l=function(y,z,A){var B=$.Deferred();var C=new tab.ClientCommand(A,y,z,tab.CommandController.DeferredSuccessHandler(B),tab.CommandController.deferredFailureHandler(B));tab.CommandController.SendCommand(C);return B;};global.tab.StoryClientCommands=n;var o=function(){};o.__typeName='tab.StoryFactory';global.tab.StoryFactory=o;var p=function(){};p.__typeName='tab.StoryNavigatorContentViewFactory';p.createContentView=function(y){if(y.get_navType()==='dot'){return new r(y);}else{return new s(y);}};global.tab.StoryNavigatorContentViewFactory=p;var q=function(y){q.$ctor1.call(this,y,p.createContentView(y));};q.__typeName='tab.StoryNavigatorPointView';q.$ctor1=function(y,z){this.$o=null;this.$q=null;this.$s=null;this.$r=null;this.$p=null;ss.makeGenericType(spiff.BaseView$1,[v]).call(this,y,new u());this.get_storyPointCaptionViewModel().add_updatePoint(ss.mkdel(this,this.$d));this.get_storyPointCaptionViewModel().add_flipboardNavTypeChanged(ss.mkdel(this,this.$c));this.get_storyPointCaptionViewModel().set_findCaptionDom(ss.mkdel(this,function(){return this.get_captionTemplate().caption;}));this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.get_storyPointCaptionViewModel().remove_updatePoint(ss.mkdel(this,this.$d));this.get_storyPointCaptionViewModel().remove_flipboardNavTypeChanged(ss.mkdel(this,this.$c));this.get_storyPointCaptionViewModel().set_findCaptionDom(null);})));this.$o=z;this.$i();this.$g();this.$j();};global.tab.StoryNavigatorPointView=q;var r=function(y){ss.makeGenericType(spiff.BaseView$1,[v]).call(this,y,new t());};r.__typeName='tab.StoryNavigatorShapeView';global.tab.StoryNavigatorShapeView=r;var s=function(y){this.$b=null;this.$a=null;ss.makeGenericType(spiff.BaseView$1,[v]).call(this,y,new t());};s.__typeName='tab.StoryNavigatorTextView';global.tab.StoryNavigatorTextView=s;var t=function(){spiff.Template.call(this,$("<div class='tabStoryPointContent'/>"));};t.__typeName='tab.StoryPointCaptionContentTemplate';global.tab.StoryPointCaptionContentTemplate=t;var u=function(){this.caption=null;this.revert=null;this.update=null;this.updateTextButton=null;this.updateIconButton=null;this.delete$1=null;this.captionTop=null;this.captionBottom=null;this.toolbar=null;spiff.Template.call(this,$("<span class='tabStoryPoint'>\n<div class='tabStoryPointToolbar'>\n  <div class='tabStoryRevert'></div>  <div class='tabStoryUpdate'><div class='tabStoryUpdateTextButton'></div><div class='tabStoryUpdateIconButton'></div></div>\n  <div class='tabStoryDelete'></div></div>\n<div class='tabStoryPointCaption'><div class='tabStoryPointCaptionTop'/><div class='tabStoryPointCaptionBottom'/></div></span>"));this.caption=this.getElementBySelector('.tabStoryPointCaption');this.revert=this.getElementBySelector('.tabStoryRevert');this.toolbar=this.getElementBySelector('.tabStoryPointToolbar');if(!tab.FeatureFlags.isEnabled('StorytellingUberNavWidgetWeb')){this.update=this.getElementBySelector('.tabStoryUpdate');this.updateIconButton=this.getElementBySelector('.tabStoryUpdateIconButton');this.updateTextButton=this.getElementBySelector('.tabStoryUpdateTextButton');this.delete$1=this.getElementBySelector('.tabStoryDelete');}this.captionTop=this.getElementBySelector('.tabStoryPointCaptionTop');this.captionBottom=this.getElementBySelector('.tabStoryPointCaptionBottom');};u.__typeName='tab.StoryPointCaptionTemplate';global.tab.StoryPointCaptionTemplate=u;var v=function(y,z){this.$6=null;this.$7=0;this.$4=null;this.$5=null;this.$2$1=null;this.$2$2=null;this.$2$3=null;this.$2$4=null;this.$2$5=null;this.$2$6=null;this.$2$7=null;this.$2$8=null;this.isCenteredHorizontally=false;this.isCenteredVertically=false;spiff.BaseViewModel.call(this);this.$6=y;this.$7=z;this.$6.add_newFlipboardNav(ss.mkdel(this,this.handleNewFlipboardNav));this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.$6.remove_newFlipboardNav(ss.mkdel(this,this.handleNewFlipboardNav));})));if(this.$6.get_navType()==='number'){this.isCenteredHorizontally=true;this.isCenteredVertically=true;}};v.__typeName='tab.StoryPointViewModel';global.tab.StoryPointViewModel=v;var w=function(){};w.__typeName='tab.StoryUIEvents';w.$2=function(y){w.$1$1=ss.delegateCombine(w.$1$1,y);};w.$3=function(y){w.$1$1=ss.delegateRemove(w.$1$1,y);};w.$4=function(y){w.$1$2=ss.delegateCombine(w.$1$2,y);};w.$5=function(y){w.$1$2=ss.delegateRemove(w.$1$2,y);};w.$0=function(){if(!ss.staticEquals(w.$1$1,null)){w.$1$1();}};w.$1=function(y){if(!ss.staticEquals(w.$1$2,null)){w.$1$2(y);}};global.tab.StoryUIEvents=w;var x=function(){this.$1$1=0;this.$1$2=0;};x.__typeName='tab.ViewingUberPopupContainer';global.tab.ViewingUberPopupContainer=x;ss.initClass(b,a,{});ss.initClass(c,a,{},spiff.Template,[ss.IDisposable]);ss.initClass(d,a,{},spiff.Template,[ss.IDisposable]);ss.initInterface(j,a,{get_dom:null,get_domRoot:null},[ss.IDisposable,tab.IAppendableView,ss.makeGenericType(tab.IView$1,[f])]);ss.initClass(e,a,{get_domRoot:function(){return this.get_template().domRoot;},get_flipboardNavViewModel:function(){return this.get_viewModel();},get_storyPointCaptionViewModel:function(){return ss.getItem(this.get_flipboardNavViewModel().get_captions(),0);},get_dom:function(){return ss.cast(this.get_template(),d);},get_scrollingView:function(){return this.$m;},$b:function(){this.$l=new c();this.$n=new spiff.ScrollableViewModel.$ctor1(false);this.$n.set_content(this.$l.domRoot[0]);this.$n.set_scrollX(true);this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){tab.StyleUtil.clearStyleSheet('flipboardNavScroller');this.$n.dispose();})));},$k:function(){if(this.get_flipboardNavViewModel().get_useDarkIcons()){this.get_domRoot().addClass('tabDarkIcons');}else{this.get_domRoot().addClass('tabLightIcons');}var y=this.get_flipboardNavViewModel().get_scrollBarStyle();if(ss.isValue(y)){tab.StyleUtil.appendCSSRuleToStyleSheet$1('flipboardNavScroller','.tabFlipboardNavScroller .iScrollHorizontalScrollbar',{'background-color':y.bgRestColor});tab.StyleUtil.appendCSSRuleToStyleSheet$1('flipboardNavScroller','.tabFlipboardNavScroller .iScrollHorizontalScrollbar:hover',ss.mkdict(['background-color',y.bgActiveColor]));tab.StyleUtil.appendCSSRuleToStyleSheet$1('flipboardNavScroller','.tabFlipboardNavScroller .iScrollHorizontalScrollbar>.iScrollIndicator',{'background-color':y.defaultColor});tab.StyleUtil.appendCSSRuleToStyleSheet$1('flipboardNavScroller','.tabFlipboardNavScroller .iScrollHorizontalScrollbar>.iScrollIndicator:hover',{'background-color':y.color});}},$f:function(){var y=new spiff.Button(this.get_dom().previous);var z=ss.mkdel(this,function(){this.get_flipboardNavViewModel().clickPrevious();});y.add_click(z);this.disposables.add$1(y);this.disposables.add$1(new tab.CallOnDispose(function(){y.remove_click(z);}));var A=new spiff.Button(this.get_dom().next);var B=ss.mkdel(this,function(){this.get_flipboardNavViewModel().clickNext();});A.add_click(B);this.disposables.add$1(A);this.disposables.add$1(new tab.CallOnDispose(function(){A.remove_click(B);}));},onAddedToDom:function(){spiff.Widget.prototype.onAddedToDom.call(this);this.$m=spiff.ScrollableView.createScrollableView(this.$n);this.$m.addToDom(this.get_dom().scroller);this.$c();},$c:function(){this.get_dom().previous.toggle(this.get_flipboardNavViewModel().get_showArrows());this.get_dom().next.toggle(this.get_flipboardNavViewModel().get_showArrows());var y=this.get_dom().previous.add(this.get_dom().next);var z;var A=this.get_flipboardNavViewModel().get_storyPointHeight();z=A+20;var B;if(this.get_flipboardNavViewModel().get_navType()==='number'||this.get_flipboardNavViewModel().get_navType()==='dot'){B='scale(.75, .7)';}else{B='scale(.875, .8125)';}this.$d();y.css(ss.mkdict(['transform',B]));var C=tab.DoubleUtil.roundToInt(this.get_dom().previousArrow.height());var D=ss.Int32.div(A-C,2);D-=3;var E;if(D<0){E=ss.mkdict(['padding-top','0px','padding-bottom','0px','margin-bottom',this.$m.get_scrollbarBuffer()+D+'px']);}else{E=ss.mkdict(['padding-top',D+'px','padding-bottom',D+'px','margin-bottom',this.$m.get_scrollbarBuffer()+'px']);}y.css(E);this.$i();if(ss.isValue(z)){this.get_dom().scroller.css('height',z+this.$m.get_scrollbarBuffer()+'px');}this.$e();this.centerNav();this.handleUpdateActivePoint(this.get_flipboardNavViewModel().get_currentPointIndex());},$d:function(){var y=this.get_dom().previous.add(this.get_dom().next);y.removeClass('ArrowLarge');y.removeClass('ArrowSmall');if(this.get_flipboardNavViewModel().get_navType()==='caption'){y.addClass('ArrowLarge');}else if(this.get_flipboardNavViewModel().get_navType()==='number'||this.get_flipboardNavViewModel().get_navType()==='dot'){y.addClass('ArrowSmall');}},$i:function(){if(ss.isNullOrUndefined(this.get_storyPointCaptionViewModel())){return;}var y={};var z={};var A={};var B={};var C={};if(ss.isValue(this.get_storyPointCaptionViewModel().get_selectedStoryPointStyle())){y=this.$g(this.get_storyPointCaptionViewModel().get_selectedStoryPointStyle());A=this.$j(this.get_storyPointCaptionViewModel().get_selectedStoryPointStyle());C=this.$h();}if(ss.isValue(this.get_storyPointCaptionViewModel().get_unselectedStoryPointStyle())){z=this.$g(this.get_storyPointCaptionViewModel().get_unselectedStoryPointStyle());B=this.$j(this.get_storyPointCaptionViewModel().get_unselectedStoryPointStyle());if(Object.keys(C).length<=0){C=this.$h();}}tab.StyleUtil.clearStyleSheet('appendedStoryStyle');tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabFlipboardNavScroller .tabScroller .tabScrollerContent .tabFlipboardNavPoints .tabStoryPoint',C);tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption.tabCurrent',y);tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption',z);tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption.tabCurrent .tabCustomScroller .tabScrollerContentWindow .tabScrollerContent .tabStoryPointContent',A);tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption .tabCustomScroller .tabScrollerContentWindow .tabScrollerContent .tabStoryPointContent',B);tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption.tabCurrent .tabStoryPointCaptionTop,.tabStoryPointCaption.tabCurrent .tabStoryPointCaptionBottom',y);tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption.tabStoryPointCaptionTop,.tabStoryPointCaption .tabStoryPointCaptionBottom',z);tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption.tabCurrent .tabScroller .tabScrollerContent .tabStoryPointContent',A);tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption .tabScroller .tabScrollerContent .tabStoryPointContent',B);tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption.tabCurrent .tabCustomScroller .tabVerticalScrollbar',{'background-color':this.get_storyPointCaptionViewModel().get_selectedStoryPointStyle().scrollBarStyle.bgRestColor});tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption .tabCustomScroller .tabVerticalScrollbar',{'background-color':this.get_storyPointCaptionViewModel().get_unselectedStoryPointStyle().scrollBarStyle.bgRestColor});tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption.tabCurrent .tabCustomScroller .tabVerticalScrollbar>.tabScrollbarIndicator',{'background-color':this.get_storyPointCaptionViewModel().get_selectedStoryPointStyle().scrollBarStyle.defaultColor});tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption .tabCustomScroller .tabVerticalScrollbar>.tabScrollbarIndicator',{'background-color':this.get_storyPointCaptionViewModel().get_unselectedStoryPointStyle().scrollBarStyle.defaultColor});tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption.tabCurrent .tabCustomScroller .tabVerticalScrollbar>.tabScrollbarIndicator:hover',{'background-color':this.get_storyPointCaptionViewModel().get_selectedStoryPointStyle().scrollBarStyle.color});tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption .tabCustomScroller .tabVerticalScrollbar>.tabScrollbarIndicator:hover',{'background-color':this.get_storyPointCaptionViewModel().get_unselectedStoryPointStyle().scrollBarStyle.color});},$g:function(y){var z=false;if(ss.isValue(y.styledBox)){return tab.FormattingConverters.makeStyledBoxCssDict(y.styledBox,z);}else{return {};}},$j:function(y){if(ss.isValue(y.textStyle)){return tab.FormattingConverters.makeFormatStyleDict(y.textStyle,null);}else{return {};}},$h:function(){var y=150;var z=70;var A={};var B=z,C=y;if(ss.isValue(this.get_viewModel().get_storyPointHeight())){B=this.get_viewModel().get_storyPointHeight();}A.height=B+20+'px';if(ss.isValue(this.get_viewModel().get_storyPointWidth())){C=this.get_viewModel().get_storyPointWidth();}A.width=C+'px';return A;},centerNav:function(){var y=this.$l.points[0].clientWidth+this.$9();var z=tab.DoubleUtil.roundToInt(this.get_dom().domRoot.parent().width());var A=0;if(z>y){A=ss.Int32.div(z-y,2);}this.get_dom().domRoot.css('margin-left',A+'px');var B=tab.DoubleUtil.roundToInt(this.get_domRoot().height());B-=2;var C=ss.Int32.div(B,2);this.get_dom().domRoot.css('margin-top','-'+C+'px');},handleResize:function(){var y=tab.DoubleUtil.roundToInt(this.get_dom().domRoot.parent().width())-this.$9();var z=this.$l.points[0].clientWidth;this.get_dom().scroller.css(ss.mkdict(['width',Math.min(y,z)+'px']));this.centerNav();this.$n.triggerRefresh();},$a:function(){this.get_viewModel().closeUberMenu();},$9:function(){return (this.get_flipboardNavViewModel().get_showArrows()?(tab.DoubleUtil.roundToInt(this.get_dom().previous.outerWidth(true))+tab.DoubleUtil.roundToInt(this.get_dom().next.outerWidth(true))):0);},handleUpdateActivePoint:function(y){this.$e();var z=this.$l.points.children().get(y);var A=z.offsetLeft;var B=A+z.offsetWidth;var C=this.$m.get_scrollerX();var D=C+tab.DoubleUtil.roundToInt(this.get_dom().scroller.width());var E=50;if(B>D){var F=tab.DoubleUtil.roundToInt(this.get_dom().scroller.width())-z.offsetWidth-E;this.$m.scrollToElement(z,0,-F,0);}else if(A<C){this.$m.scrollToElement(z,0,-50,0);}this.get_dom().previous.toggleClass('tabDisabled',this.get_flipboardNavViewModel().get_previousDisabled());this.get_dom().next.toggleClass('tabDisabled',this.get_flipboardNavViewModel().get_nextDisabled());},$e:function(){var y=this.get_template().getElementsBySelector('.tabStoryPoint');y.remove();var z=ss.getEnumerator(this.get_flipboardNavViewModel().get_captions());try{while(z.moveNext()){var A=z.current();var B=tab.ObjectRegistry.newView(l).call(null,[A]);B.addToDom(this.$l.points);}}finally{z.dispose();}this.handleResize();}},ss.makeGenericType(spiff.BaseView$1,[f]),[tab.IWidget,tab.IAppendableView,ss.IDisposable,ss.makeGenericType(tab.IView$1,[f]),j]);ss.initClass(f,a,{add_resizeZone:function(y){this.$2$1=ss.delegateCombine(this.$2$1,y);},remove_resizeZone:function(y){this.$2$1=ss.delegateRemove(this.$2$1,y);},add_updateActivePoint:function(y){this.$2$2=ss.delegateCombine(this.$2$2,y);},remove_updateActivePoint:function(y){this.$2$2=ss.delegateRemove(this.$2$2,y);},add_remoteUpdateComplete:function(y){this.$2$3=ss.delegateCombine(this.$2$3,y);},remove_remoteUpdateComplete:function(y){this.$2$3=ss.delegateRemove(this.$2$3,y);},get_currentPointIndex:function(){return this.$d.get_currentPointIndex();},get_numberOfPoints:function(){return this.$d.get_storyPoints().length;},get_storyPointHeight:function(){return this.$d.get_height();},get_storyPointWidth:function(){return this.$d.get_width();},get_previousDisabled:function(){return this.get_currentPointIndex()<=0;},get_nextDisabled:function(){return this.get_currentPointIndex()>=this.get_numberOfPoints()-1;},get_showArrows:function(){return this.$d.get_flipboardNavPresModel().navArrowsVisible;},get_captions:function(){return this.$a;},get_useDarkIcons:function(){return this.$d.get_flipboardNavPresModel().flipboardNavStyle.useDarkIcons;},get_scrollBarStyle:function(){return this.$d.get_flipboardNavPresModel().flipboardNavStyle.scrollBarStyle;},get_navType:function(){return this.$d.get_navType();},get_currentStoryPointId:function(){return (ss.isValue(this.$d)?this.$d.get_storyPoints()[this.get_currentPointIndex()].storyPointId:0);},handleNewFlipboardNav:function(){if(ss.isValue(this.$2$2)){this.updatePoints();this.$2$2(this.get_currentPointIndex());}if(!this.$c){var y=tab.CommandController.get();var z=null;z=ss.mkdel(this,function(){y.remove_commandQueueComplete(z);this.$c=false;this.raiseActionEvent(this.$2$3);this.$5();this.$e.updatePoints(this.$a,this.get_currentStoryPointId());});y.add_commandQueueComplete(z);this.$c=true;}},handlePointWasCaptured:function(y){this.$b.push(y);},handleNavArrowVisibilityChanged:function(){this.closeUberMenu();},updatePoints:function(){this.$7();this.$2();},$5:function(){for(var y=0;y<this.$b.length;y++){var z=this.$b[y];this.$6(z);}},$6:function(y){var z=b.getViewModelFromStoryId(this.$a,y);if(ss.isValue(z)){z.notifyPointWasCaptured();}},$4:function(){this.closeUberMenu();this.raiseActionEvent(this.$2$1);},$7:function(){for(var y=0;y<this.$a.length;y++){var z=this.$a[y];z.remove_pointUpdatedShown(ss.mkdel(this,this.clearUpdatedPoint));z.remove_showUberMenuForPoint(ss.mkdel(this,this.showUberMenu));z.remove_hideUberMenuForPoint(ss.mkdel(this,this.hideUberMenu));z.remove_closeUberMenu(ss.mkdel(this,this.closeUberMenu));z.remove_showUpdatedToastOnReload(ss.mkdel(this,this.handlePointWasCaptured));z.dispose();}ss.clear(this.$a);},$2:function(){for(var y=0;y<this.get_numberOfPoints();y++){var z=new v(this.$d,y);z.add_pointUpdatedShown(ss.mkdel(this,this.clearUpdatedPoint));z.add_showUberMenuForPoint(ss.mkdel(this,this.showUberMenu));z.add_hideUberMenuForPoint(ss.mkdel(this,this.hideUberMenu));z.add_closeUberMenu(ss.mkdel(this,this.closeUberMenu));z.add_showUpdatedToastOnReload(ss.mkdel(this,this.handlePointWasCaptured));this.$a.push(z);}},clearUpdatedPoint:function(y){ss.remove(this.$b,y);},showUberMenu:function(y){this.$e.showUber(y);},hideUberMenu:function(y){this.$e.hideUberWithTimeoutAndFade();},hideUberMenuImmediately:function(){this.$e.hideUberWithFade();},$9:function(){this.$e.updatePoints(this.$a,this.get_currentStoryPointId());},closeUberMenu:function(){this.$e.close();},clickNext:function(){return this.$3(n.nextStoryPoint,this.get_nextDisabled());},clickPrevious:function(){return this.$3(n.previousStoryPoint,this.get_previousDisabled());},$3:function(y,z){var A=$.Deferred();if(z){A.resolve(this.get_currentPointIndex());}else{this.$8(A,ss.mkdel(this,function(){return y(this.$d);}));}this.closeUberMenu();return A.promise();},dispose:function(){this.$7();spiff.BaseViewModel.prototype.dispose.call(this);},$8:function(y,z){var A=ss.mkdel(this,function(){y.resolve(this.get_currentPointIndex());});var B=function(){y.reject(ss.unbox(ss.cast(arguments[0],ss.Int32)));};z().then(A,B);}},spiff.BaseViewModel,[ss.IDisposable,tab.IViewModel,tab.IFlipboardNavigatorViewModel]);ss.initClass(g,a,{},spiff.Template,[ss.IDisposable]);ss.initClass(h,a,{onAddedToDom:function(){spiff.Widget.prototype.onAddedToDom.call(this);if(ss.isValue(this.$a.get_dashboardViewModel())){this.handleNewStoryPoint();}},handleNewStoryPoint:function(){var y={w:tab.DoubleUtil.roundToInt(this.element.width()),h:tab.DoubleUtil.roundToInt(this.element.height())};this.$a.get_dashboardViewModel().set_size(h.$0(tab.RecordCast.sizeAsSizePresModel(y),this.$a.get_dashboardViewModel().get_size()));this.$9();var z=tab.ObjectRegistry.newView(tab.DashboardView).call(null,[this.$a.get_dashboardViewModel()]);z.addToDom(this.get_template().domRoot);},handleResizeZone:function(){var y={w:this.$a.get_parentZone().get_contentWidth(),h:this.$a.get_parentZone().get_contentHeight()};this.$a.get_dashboardViewModel().set_size(h.$0(tab.RecordCast.sizeAsSizePresModel(y),this.$a.get_dashboardViewModel().dashboardModel.get_dashboardSize()));this.$9();},$9:function(){var y=this.$a.get_parentZone().get_contentWidth();var z=this.$a.get_parentZone().get_contentHeight();var A=this.$a.get_dashboardViewModel().dashboardModel.get_dashboardSize();if(A.w<=y&&A.h<=z+3){this.element.css('overflow','hidden');}else{this.element.css('overflow','auto');}}},ss.makeGenericType(spiff.BaseView$1,[i]),[tab.IWidget,tab.IAppendableView,ss.IDisposable,ss.makeGenericType(tab.IView$1,[i])]);ss.initClass(i,a,{add_newStoryPoint:function(y){this.$2$1=ss.delegateCombine(this.$2$1,y);},remove_newStoryPoint:function(y){this.$2$1=ss.delegateRemove(this.$2$1,y);},get_flipboardModel:function(){return this.$7;},get_dashboardViewModel:function(){return this.$6;},$5:function(){return this.get_flipboardModel().get_dashboardModel().pm;},get_parentZone:function(){return this.$8;},$3:function(){this.$2();if(ss.isValue(this.$5())){this.$6=tab.DashboardViewModel.new$1(this.get_flipboardModel().get_dashboardModel());this.raiseActionEvent(this.$2$1);}tab.Application.handleAllFontsFound();},$4:function(){this.$8.forceZoneValidState(false);},dispose:function(){this.$2();spiff.BaseViewModel.prototype.dispose.call(this);},$2:function(){if(ss.isValue(this.get_dashboardViewModel())){this.$6.dispose();this.$6=null;}}},spiff.BaseViewModel,[ss.IDisposable,tab.IViewModel,tab.IFlipboardViewModel]);ss.initInterface(k,a,{get_rootTemplate:null,styleCaption:null,handleUpdatePoint:null,setupContent:null},[ss.IDisposable,tab.IAppendableView,ss.makeGenericType(tab.IView$1,[v])]);ss.initInterface(l,a,{get_contentTemplate:null,get_captionTemplate:null},[ss.IDisposable,tab.IAppendableView,ss.makeGenericType(tab.IView$1,[v])]);ss.initInterface(m,a,{get_isShowing:null,get_isShowingWithHide:null,get_targetStoryPointId:null,get_timeoutMs:null,set_timeoutMs:null,get_fadeMs:null,set_fadeMs:null,updatePoints:null,showUber:null,hideUberWithTimeoutAndFade:null,hideUberWithFade:null,showUberWithTimeoutAndFade:null,close:null},[ss.IDisposable]);ss.initClass(n,a,{});ss.initClass(o,a,{newFlipboardNavigatorViewModel:function(y){return new f(y);},newFlipboardViewModel:function(y,z){return new i(y,z);},newFlipboardNavigatorView:function(y){return tab.ObjectRegistry.newView(j).call(null,[y]);},newFlipboardView:function(y){return tab.ObjectRegistry.newView(h).call(null,[y]);},insertStoryPoint:function(y,z){return n.insertStoryPoint(y,z);},replaceStoryPoint:function(y,z){return n.replaceStoryPoint(y,z);},fireCloseStoryUberMenu:function(){w.$0();},fireShowUpdateToast:function(y){w.$1(y);}},null,[tab.IStoryModule]);ss.initClass(p,a,{});ss.initClass(q,a,{get_domRoot:function(){return this.get_template().domRoot;},get_contentTemplate:function(){return ss.cast(this.$o.get_rootTemplate(),t);},get_storyPointCaptionViewModel:function(){return this.get_viewModel();},get_captionTemplate:function(){return ss.cast(this.get_template(),u);},onAddedToDom:function(){spiff.Widget.prototype.onAddedToDom.call(this);this.$c();},$c:function(){this.$o.addToDom(this.get_captionTemplate().caption);this.$o.styleCaption(this.get_captionTemplate());this.$d();if(tsConfig.is_authoring){this.$n();}},$i:function(){if(this.get_storyPointCaptionViewModel().get_isFirstPoint()){this.get_domRoot().addClass('tabFirstPoint');}if(this.get_storyPointCaptionViewModel().get_isLastPoint()){this.get_domRoot().addClass('tabLastPoint');}},$d:function(){if(tsConfig.is_authoring&&!tab.FeatureFlags.isEnabled('StorytellingUberNavWidgetWeb')){if(this.get_viewModel().get_width()<this.$q.element.width()+this.$s.element.width()+this.$p.element.width()+12){this.$r.element.addClass('small');this.$q.element.addClass('small');this.$p.element.addClass('small');if(this.get_viewModel().get_navType()!=='caption'){this.$9();}else{this.$e();}this.get_captionTemplate().updateIconButton.show();this.get_captionTemplate().updateTextButton.hide();this.get_captionTemplate().delete$1.toggle(this.get_storyPointCaptionViewModel().get_isCaptured()&&!this.get_viewModel().get_isStoryEmpty());}else{this.$r.element.removeClass('small');this.$q.element.removeClass('small');this.$p.element.removeClass('small');this.get_captionTemplate().update.append(this.$s.element);this.get_captionTemplate().updateIconButton.hide();this.get_captionTemplate().updateTextButton.show();this.get_captionTemplate().delete$1.toggle(!this.get_viewModel().get_isStoryEmpty());}this.get_captionTemplate().update.toggle(!this.get_storyPointCaptionViewModel().get_isCaptured());}else{if(!tab.FeatureFlags.isEnabled('StorytellingUberNavWidgetWeb')){this.get_captionTemplate().update.hide();}if(this.get_viewModel().get_navType()!=='caption'){this.$9();}}if(tab.FeatureFlags.isEnabled('StorytellingUberNavWidgetWeb')&&tsConfig.is_authoring){this.get_captionTemplate().revert.hide();}else{this.get_captionTemplate().revert.toggle(!this.get_storyPointCaptionViewModel().get_isCaptured());}this.get_captionTemplate().caption.toggleClass('tabCurrent',this.get_storyPointCaptionViewModel().get_isCurrentPoint());this.$o.handleUpdatePoint();},$9:function(){var y=this.get_captionTemplate().revert.find('.tab-iconButton');var z=y.width();if(!tsConfig.is_authoring){var A=(this.get_viewModel().get_width()-z)/2;y.css('left',A+'px');}else if(tsConfig.is_authoring&&!tab.FeatureFlags.isEnabled('StorytellingUberNavWidgetWeb')){var B=this.get_captionTemplate().update.find('.tab-iconButton');var C=B.width();var D=(this.get_viewModel().get_width()-z-C-4)/2;var E=D+y.width()+4;y.css('left',D+'px');B.css('left',E+'px');}},$e:function(){if(!tab.FeatureFlags.isEnabled('StorytellingUberNavWidgetWeb')){var y=this.get_captionTemplate().revert.find('.tab-iconButton');var z=this.get_captionTemplate().update.find('.tab-iconButton');var A=y.width()+4;z.css('left',A+'px');}},$n:function(){if(!tab.FeatureFlags.isEnabled('StorytellingUberNavWidgetWeb')){this.$p.element.removeClass('tabDeleteIconCaption');this.$p.element.removeClass('tabDeleteIconNumber');this.$p.element.removeClass('tabDeleteIconDot');switch(this.get_viewModel().get_navType()){case 'caption':{this.$p.element.addClass('tabDeleteIconCaption');this.$p.element.css('margin','auto');break;}case 'number':{this.$p.element.addClass('tabDeleteIconNumber');this.$p.element.css('margin','auto');break;}case 'dot':{this.$p.element.addClass('tabDeleteIconDot');var y=this.get_storyPointCaptionViewModel().get_width();var z=this.$p.element.width();var A=(y-z)/2;this.$p.element.css('margin','auto '+A+'px auto '+A+'px');break;}default:{break;}}}},$j:function(){this.$f();this.$l();if(tsConfig.is_authoring&&!tab.FeatureFlags.isEnabled('StorytellingUberNavWidgetWeb')){this.$m();this.$h();}this.$k();},$k:function(){var y={};spiff.EventHandleSpecExtensions.setHandler(y,'hover',ss.mkdel(this,this.$a));spiff.EventHandleSpecExtensions.setHandler(y,'mouseleave',ss.mkdel(this,this.$b));this.disposables.add$1(new spiff.TableauEventHandler.$ctor1(this.get_captionTemplate().caption[0],y));},$a:function(){this.get_viewModel().showUberMenu();},$b:function(){this.get_viewModel().hideUberMenu();},$l:function(){this.get_captionTemplate().revert.attr('title',tab.Strings.StoryPointRevertTooltip);this.$q=new spiff.IconButton();this.$q.setIcon('tabStoryRevertSmallIcon');this.get_captionTemplate().revert.append(this.$q.element);this.disposables.add$1(this.$q.onClick(ss.mkdel(this,function(y){this.get_storyPointCaptionViewModel().revertStoryPoint();})));this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.$q.dispose();})));},$m:function(){if(!tab.FeatureFlags.isEnabled('StorytellingUberNavWidgetWeb')){var y=ss.mkdel(this,function(){this.get_viewModel().captureStoryPoint();});this.$s=spiff.StyledTextButton.createUnificationLabelButton(y,tab.Strings.StoryPointUpdateButton,'tabStoryUpdateButton',3,null);this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.$s.remove_click(y);})));this.$r=new spiff.IconButton();this.$r.setIcon('tabStoryUpdateSmallIcon');this.get_captionTemplate().update.attr('title',tab.Strings.StoryPointUpdateButton);this.disposables.add$1(this.$r.onClick(ss.mkdel(this,function(z){this.get_viewModel().captureStoryPoint();})));this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.$s.dispose();this.$r.dispose();})));this.get_captionTemplate().updateIconButton.append(this.$r.element);this.get_captionTemplate().updateTextButton.append(this.$s.element);}},$h:function(){if(!tab.FeatureFlags.isEnabled('StorytellingUberNavWidgetWeb')){this.get_captionTemplate().delete$1.attr('title',tab.Strings.StoryPointDeleteTooltip);this.$p=new spiff.IconButton();this.$p.setIcon('tabStoryDeleteSmallIcon');this.get_captionTemplate().delete$1.append(this.$p.element);this.disposables.add$1(this.$p.onClick(ss.mkdel(this,function(y){this.get_storyPointCaptionViewModel().deleteStoryPoint();})));this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.$p.dispose();})));this.$n();}},$f:function(){this.disposables.add$1((new spiff.ClickHandler()).setTarget(this.get_captionTemplate().caption).onClick(ss.mkdel(this,function(y){y.stopPropagation();this.get_storyPointCaptionViewModel().clickStoryPoint();})));},$g:function(){this.$o.setupContent();}},ss.makeGenericType(spiff.BaseView$1,[v]),[tab.IWidget,tab.IAppendableView,ss.IDisposable,ss.makeGenericType(tab.IView$1,[v]),l]);q.$ctor1.prototype=q.prototype;ss.initClass(r,a,{get_rootTemplate:function(){return this.get_template();},handleUpdatePoint:function(){},styleCaption:function(y){y.domRoot.addClass('tabFormatted');if(tab.FeatureFlags.isEnabled('StorytellingUberNavWidgetWeb')){y.domRoot.addClass(r.storyPointDotClassName);}y.caption.addClass(r.circleClassName);y.captionBottom.hide();y.captionTop.hide();var z=Math.floor(this.get_viewModel().get_width()*r.dotsScale);var A=Math.floor(this.get_viewModel().get_height()*r.dotsScale);y.caption.width(z+'px');y.caption.height(A+'px');var B=ss.round(y.caption.outerWidth()-y.caption.innerWidth());var C=this.get_viewModel().get_width()-z-B;var D=this.get_viewModel().get_height()-A;C=Math.max(ss.Int32.div(C,2),0);D=Math.max(ss.Int32.div(D,2),0);y.caption.css('left',C+'px');y.caption.css('top',D+ss.round(y.toolbar.outerHeight())+'px');},setupContent:function(){this.get_template().domRoot.text('');}},ss.makeGenericType(spiff.BaseView$1,[v]),[tab.IWidget,tab.IAppendableView,ss.IDisposable,ss.makeGenericType(tab.IView$1,[v]),k]);ss.initClass(s,a,{get_rootTemplate:function(){return this.get_template();},addToDom:function(y){spiff.Widget.prototype.addToDom.call(this,y);this.$a=spiff.ScrollableView.createScrollableView(this.$b);this.$a.addToDom(y);},styleCaption:function(y){if(this.$b.get_hasCustomIndicator()){y.domRoot.addClass('tabFormatted');y.captionBottom.remove();y.captionTop.remove();}var z=ss.mkdict(['right',this.$a.get_scrollbarBuffer()+'px']);y.captionTop.css(z);y.captionBottom.css(z);},handleUpdatePoint:function(){this.$b.triggerRefresh();},setupContent:function(){this.$9(this.get_viewModel());var y=new spiff.ScrollableViewModel();y.set_content(this.get_template().domRoot[0]);y.isCenteredVertically=this.get_viewModel().isCenteredVertically;y.set_scrollY(this.get_viewModel().get_navType()!=='number');y.set_scrollX(false);this.$b=y;this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.$b.dispose();})));},$9:function(y){if(y.isCenteredHorizontally){this.get_template().domRoot.addClass('centered');}var z=((ss.isNullOrEmptyString(y.get_caption())&&tsConfig.is_authoring)?tab.Strings.StoryEmptyCaptionText:y.get_caption());this.get_template().domRoot.text(z);}},ss.makeGenericType(spiff.BaseView$1,[v]),[tab.IWidget,tab.IAppendableView,ss.IDisposable,ss.makeGenericType(tab.IView$1,[v]),k]);ss.initClass(t,a,{},spiff.Template,[ss.IDisposable]);ss.initClass(u,a,{},spiff.Template,[ss.IDisposable]);ss.initClass(v,a,{add_updatePoint:function(y){this.$2$1=ss.delegateCombine(this.$2$1,y);},remove_updatePoint:function(y){this.$2$1=ss.delegateRemove(this.$2$1,y);},add_flipboardNavTypeChanged:function(y){this.$2$2=ss.delegateCombine(this.$2$2,y);},remove_flipboardNavTypeChanged:function(y){this.$2$2=ss.delegateRemove(this.$2$2,y);},add_pointCaptured:function(y){this.$2$3=ss.delegateCombine(this.$2$3,y);},remove_pointCaptured:function(y){this.$2$3=ss.delegateRemove(this.$2$3,y);},add_pointUpdatedShown:function(y){this.$2$4=ss.delegateCombine(this.$2$4,y);},remove_pointUpdatedShown:function(y){this.$2$4=ss.delegateRemove(this.$2$4,y);},add_showUberMenuForPoint:function(y){this.$2$5=ss.delegateCombine(this.$2$5,y);},remove_showUberMenuForPoint:function(y){this.$2$5=ss.delegateRemove(this.$2$5,y);},add_hideUberMenuForPoint:function(y){this.$2$6=ss.delegateCombine(this.$2$6,y);},remove_hideUberMenuForPoint:function(y){this.$2$6=ss.delegateRemove(this.$2$6,y);},add_closeUberMenu:function(y){this.$2$7=ss.delegateCombine(this.$2$7,y);},remove_closeUberMenu:function(y){this.$2$7=ss.delegateRemove(this.$2$7,y);},add_showUpdatedToastOnReload:function(y){this.$2$8=ss.delegateCombine(this.$2$8,y);},remove_showUpdatedToastOnReload:function(y){this.$2$8=ss.delegateRemove(this.$2$8,y);},$3:function(){return this.$6.get_storyPoints()[this.$7];},get_isCurrentPoint:function(){return this.$7===this.$6.get_currentPointIndex();},get_isCaptured:function(){return this.$3().isCaptured;},get_caption:function(){return this.$3().storyPointCaption;},get_storyPointId:function(){return this.$3().storyPointId;},get_storyPointIndex:function(){return this.$7;},get_isFirstPoint:function(){return this.get_storyPointIndex()===0;},get_isLastPoint:function(){return this.$7===this.$6.get_storyPoints().length-1;},get_storyPointStyle:function(){if(this.get_isCurrentPoint()){return this.get_selectedStoryPointStyle();}else{return this.get_unselectedStoryPointStyle();}},get_selectedStoryPointStyle:function(){return this.$6.get_flipboardNavPresModel().selectedStoryPointStyle;},get_unselectedStoryPointStyle:function(){return this.$6.get_flipboardNavPresModel().unselectedStoryPointStyle;},get_width:function(){return this.$6.get_width();},get_height:function(){return this.$6.get_height();},get_navType:function(){return this.$6.get_flipboardNavPresModel().flipboardNavStyle.flipboardNavType;},get_isStoryEmpty:function(){return this.$6.get_isStoryEmpty();},get_findCaptionDom:function(){if(ss.staticEquals(this.$5,null)){this.$5=function(){return null;};}return this.$5;},set_findCaptionDom:function(y){this.$5=y;},handleNewFlipboardNav:function(){var y=this.get_navType()!==this.$4;if(y){this.raiseActionEvent(this.$2$2);}else{this.raiseActionEvent(this.$2$1);}this.$4=this.get_navType();},notifyPointWasCaptured:function(){this.raiseActionEvent(this.$2$3);},notifyPointUpdatedWasShown:function(){this.raiseActionEvent$1(ss.Int32).call(this,this.$2$4,this.get_storyPointId());},showUberMenu:function(){this.raiseActionEvent$1(ss.Int32).call(this,this.$2$5,this.get_storyPointId());},hideUberMenu:function(){this.raiseActionEvent$1(ss.Int32).call(this,this.$2$6,this.get_storyPointId());},closeUber:function(){this.raiseActionEvent(this.$2$7);},markPointUpdated:function(){this.raiseActionEvent$1(ss.Int32).call(this,this.$2$8,this.get_storyPointId());},clickStoryPoint:function(){return this.$2(ss.mkdel(this,function(){return n.setActiveStoryPoint(this.$7,this.$6);}),this.get_isCurrentPoint());},revertStoryPoint:function(){return this.$2(ss.mkdel(this,function(){return n.revertStoryPoint(tab.ModelUtils.findContentDashboard().get_sheetPath(),this.$3().storyPointId);}),this.get_isCaptured());},captureStoryPoint:function(){return this.$2(ss.mkdel(this,function(){return n.captureStoryPoint(this.get_storyPointId());}),this.get_isCaptured());},deleteStoryPoint:function(){return this.$2(ss.mkdel(this,function(){return n.deleteStoryPoint(this.get_storyPointId());}),false);},editStoryPointCaption:function(y){return this.$2(ss.mkdel(this,function(){return n.editStoryPointCaption(y,this.get_storyPointId(),this.$6);}),ss.compareStrings(this.get_caption(),y,false)===0);},$2:function(y,z){var A=$.Deferred();if(z){return A.resolve(this);}else{var B=ss.mkdel(this,function(){A.resolve(this);});var C=function(){A.reject(ss.cast(arguments[0],tab.IStoryPointCaptionViewModel));};var D=y();D.then(B,C);}return A.promise();}},spiff.BaseViewModel,[ss.IDisposable,tab.IViewModel,tab.IStoryPointCaptionViewModel]);ss.initClass(w,a,{});ss.initClass(x,a,{get_isShowing:function(){return false;},get_isShowingWithHide:function(){return false;},get_targetStoryPointId:function(){return 0;},get_timeoutMs:function(){return this.$1$1;},set_timeoutMs:function(y){this.$1$1=y;},get_fadeMs:function(){return this.$1$2;},set_fadeMs:function(y){this.$1$2=y;},updatePoints:function(y,z){},showUber:function(y){},hideUberWithTimeoutAndFade:function(){},hideUberWithFade:function(){},showUberWithTimeoutAndFade:function(y){},close:function(){},dispose:function(){}},null,[ss.IDisposable,m]);(function(){c.$0="<span class='tabFlipboardNavPoints'/>";})();(function(){d.$0="<div class='tabFlipboardNav'><span class='tabFlipboardNavPrevious'><div class='tabStoryLeftArrow'/></span><span class='tabFlipboardNavScroller'/><span class='tabFlipboardNavNext'><div class='tabStoryRightArrow'/></span></div>";})();(function(){w.$1$1=null;w.$1$2=null;})();(function(){e.horizontalScrollerSelector='.tabFlipboardNavScroller .iScrollHorizontalScrollbar';e.horizontalScrollerHoverSelector='.tabFlipboardNavScroller .iScrollHorizontalScrollbar:hover';e.horizontalScrollerIndicatorSelector='.tabFlipboardNavScroller .iScrollHorizontalScrollbar>.iScrollIndicator';e.horizontalScrollerIndicatorHoverSelector='.tabFlipboardNavScroller .iScrollHorizontalScrollbar>.iScrollIndicator:hover';e.storyPointSelector='.tabFlipboardNavScroller .tabScroller .tabScrollerContent .tabFlipboardNavPoints .tabStoryPoint';e.selectedStoryPointBoxSelector='.tabStoryPointCaption.tabCurrent';e.unselectedStoryPointBoxSelector='.tabStoryPointCaption';e.selectedStoryPointTextSelector='.tabStoryPointCaption.tabCurrent .tabCustomScroller .tabScrollerContentWindow .tabScrollerContent .tabStoryPointContent';e.unselectedStoryPointTextSelector='.tabStoryPointCaption .tabCustomScroller .tabScrollerContentWindow .tabScrollerContent .tabStoryPointContent';e.selectedStoryPointScrollbarSelector='.tabStoryPointCaption.tabCurrent .tabCustomScroller .tabVerticalScrollbar';e.unselectedStoryPointScrollbarSelector='.tabStoryPointCaption .tabCustomScroller .tabVerticalScrollbar';e.selectedStoryPointScrollbarIndicatorSelector='.tabStoryPointCaption.tabCurrent .tabCustomScroller .tabVerticalScrollbar>.tabScrollbarIndicator';e.unselectedStoryPointScrollbarIndicatorSelector='.tabStoryPointCaption .tabCustomScroller .tabVerticalScrollbar>.tabScrollbarIndicator';e.selectedStoryPointScrollbarIndicatorHoverSelector='.tabStoryPointCaption.tabCurrent .tabCustomScroller .tabVerticalScrollbar>.tabScrollbarIndicator:hover';e.unselectedStoryPointScrollbarIndicatorHoverSelector='.tabStoryPointCaption .tabCustomScroller .tabVerticalScrollbar>.tabScrollbarIndicator:hover';e.selectedStoryPointNativeScrollerTopBottomSelector='.tabStoryPointCaption.tabCurrent .tabStoryPointCaptionTop,.tabStoryPointCaption.tabCurrent .tabStoryPointCaptionBottom';e.unselectedStoryPointNativeScrollerTopBottomSelector='.tabStoryPointCaption.tabStoryPointCaptionTop,.tabStoryPointCaption .tabStoryPointCaptionBottom';e.selectedStoryPointNativeScrollerTextSelector='.tabStoryPointCaption.tabCurrent .tabScroller .tabScrollerContent .tabStoryPointContent';e.unselectedStoryPointNativeScrollerTextSelector='.tabStoryPointCaption .tabScroller .tabScrollerContent .tabStoryPointContent';e.storyStyleSheetId='appendedStoryStyle';tab.ObjectRegistry.registerType(j,e).call(null);})();(function(){g.flipboardClassName='tabFlipboard';g.$0="<div class='tabFlipboard'></div>";})();(function(){h.scrollBarThickness=24;h.additionalHeightForMarginsOfContent=3;tab.ObjectRegistry.registerType(h,h).call(null);})();(function(){t.$0="<div class='tabStoryPointContent'/>";})();(function(){r.circleClassName='tabStoryPointCircle';r.storyPointDotClassName='tabStoryPointDot';r.dotsScale=0.75;})();(function(){s.centeredClassName='centered';s.paddedClassName='padded';})();(function(){u.$0="<span class='tabStoryPoint'>\n<div class='tabStoryPointToolbar'>\n  <div class='tabStoryRevert'></div>  <div class='tabStoryUpdate'><div class='tabStoryUpdateTextButton'></div><div class='tabStoryUpdateIconButton'></div></div>\n  <div class='tabStoryDelete'></div></div>\n<div class='tabStoryPointCaption'><div class='tabStoryPointCaptionTop'/><div class='tabStoryPointCaptionBottom'/></div></span>";})();(function(){q.centeredClassName='centered';q.buttonPixelBuffer=12;q.revertUpdateSpacing=4;tab.ObjectRegistry.registerType(l,q).call(null);})();(function(){tab.ObjectRegistry.registerType(m,x).call(null);})();})();// END StoryModule
